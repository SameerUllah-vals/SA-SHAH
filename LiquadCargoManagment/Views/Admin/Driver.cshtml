
@{
    ViewBag.Title = "Driver";
}


<div class="content-header">

    <div class="header-section">
        <h1>
            Driver<br><small>Create Read Update Delete Drivers</small>
        </h1>
    </div>

</div>
<ul class="breadcrumb breadcrumb-top">
    <li>Admin</li>
    <li><a href="javascript:;">Driver</a></li>
</ul>

<!-- END Datatables Header -->
<!-- Datatables Content -->
<div class="block full">
    <div class="block-title row">
        <div class="col-md-12">
            <a id="" class="btn btn-primary btn-sm pull-right" onclick="$('#modal-add').modal('show'); ClearItem(); Enable();" href="#">Add New | <i class="fa fa-plus"></i></a>
        </div>
    </div>

    <div class="" id="grid">
        @Html.Partial("_Driver")
    </div>
</div>

<!-- END Datatables Content -->





<div id="modal-add" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <!-- Modal Header -->
            <div class="modal-header text-center">
                <h2 class="modal-title"><i class="fa fa-pencil-alt"></i> Driver</h2>
            </div>
            <!-- END Modal Header -->
            <!-- Modal Body -->
            @using (Ajax.BeginForm("addDriver", "Admin", new AjaxOptions() { HttpMethod = "POST", OnSuccess = "fnSuccess", OnFailure = "fnFailed" }, new { enctype = "multipart/form-data" }))
            {
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-12">
                            <div class="block full">
                                <!-- Block Tabs Title -->
                                <div class="block-title">
                                    <ul class="nav nav-tabs" data-toggle="tabs">
                                        <li class="active"><a href="#example-tabs2-activity" data-toggle="tooltip" title="Driver">Driver Info</a></li>
                                        @*<li><a href="#example-tabs2-profile">Details</a></li>*@
                                        @*<li><a href="#example-tabs2-Driver">Driver</a></li>*@
                                        <li><a href="#example-tabs2-License" data-toggle="tooltip" title="License">License Issue</a></li>
                                        @*<li><a href="#example-tabs2-loading" data-toggle="tooltip" title="loading">Capacity &amp; Documents</a></li>*@
                                        <li><a href="#example-tabs2-NIC" data-toggle="tooltip" title="NIC">NIC Issue</a></li>
                                        <li><a href="#example-tabs2-Contact" data-toggle="tooltip" title="Contact">Contact</a></li>
                                    </ul>
                                </div>
                                <!-- END Block Tabs Title -->
                                <!-- Tabs Content -->
                                <div class="tab-content">
                                    <div class="tab-pane active" id="example-tabs2-activity">
                                        <div class="row">
                                            <div class="col-md-4">
                                                <input type="hidden" name="ID" id="hfEditID" />
                                                <label class="control-label">Code</label>
                                                <input type="text" id="Code" name="Code" class="form-control" />
                                            </div>
                                            <div class="col-md-4">
                                                <label class="control-label">Name</label>
                                                <input type="text" id="Name" name="Name" class="form-control" />
                                            </div>
                                            <div class="col-md-4">
                                                <label class="control-label">Father Name</label>
                                                <input type="text" id="FatherName" name="FatherName" class="form-control" />
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-4">
                                                <label class="control-label">Type</label>
                                                <input type="text" id="Type" name="Type" class="form-control" />
                                            </div>
                                            <div class="col-md-4">
                                                <label class="control-label">Date Of Birth</label>
                                                <input type="date" id="DateOfBirth" name="DateOfBirth" class="form-control" />

                                            </div>
                                            <div class="col-md-4">
                                                <label class="control-label">Gender</label>
                                                <input type="text" id="Gender" name="Gender" class="form-control" />
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-4">
                                                <label class="control-label">Blood Group</label>
                                                <input type="text" id="BloodGroup" name="BloodGroup" class="form-control" />
                                            </div>
                                            <div class="col-md-4">
                                                <label class="control-label">Identity Mark</label>
                                                <input type="text" id="IdentityMark" name="IdentityMark" class="form-control" />
                                            </div>
                                            <div class="col-md-4">
                                                <label class="control-label">Upload Document</label>
                                                <input type="file" name="file" class="form-control" />
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-12">
                                                <label class="control-label">Address</label>
                                                <textarea id="Address" name="Address" class="form-control"></textarea>
                                            </div>
                                            <div class="col-md-12">
                                                <label class="control-label">Description</label>
                                                <textarea id="Description" name="Description" class="form-control"></textarea>
                                            </div>
                                        </div>
                                    </div>


                                    <div class="tab-pane" id="example-tabs2-License">
                                        <div class="row">
                                            <div class="col-md-6">
                                                <label class="control-label">License Category</label>
                                                <input type="text" id="LicenseCategory" name="LicenseCategory" class="form-control" />
                                            </div>
                                            <div class="col-md-6">
                                                <label class="control-label">License Issue Date</label>
                                                <input type="datetime-local" id="LicenseIssueDate" name="LicenseIssueDate" class="form-control" />
                                            </div>
                                            <div class="col-md-6">
                                                <label class="control-label">License Expiry Date</label>
                                                <input type="date" id="LicenseExpiryDate" name="LicenseExpiryDate" class="form-control" />
                                            </div>
                                            <div class="col-md-6">
                                                <label class="control-label">License No</label>
                                                <input type="number" id="LicenseNo" name="LicenseNo" class="form-control" />
                                            </div>
                                            <div class="col-md-6">
                                                <label class="control-label">License Issuing Authority</label>
                                                <input type="text" id="LicenseIssuingAuthority" name="LicenseIssuingAuthority" class="form-control" />
                                            </div>
                                            <div class="col-md-6">
                                                <label class="control-label">License Status</label>
                                                <input type="text" id="LicenseStatus" name="LicenseStatus" class="form-control" />
                                            </div>
                                        </div>
                                    </div>


                                    <div class="tab-pane" id="example-tabs2-NIC">
                                        <div class="row">
                                            <div class="col-md-12">
                                                <label class="control-label">NIC Issue Date</label>
                                                <input type="date" id="NICIssueDate" name="NICIssueDate" class="form-control" />
                                            </div>
                                            <div class="col-md-12">
                                                <label class="control-label">NIC Expiry Date</label>
                                                <input type="date" id="NICExpiryDate" name="NICExpiryDate" class="form-control" />
                                            </div>
                                            <div class="col-md-12">
                                                <label class="control-label">NIC No</label>
                                                <input type="number" id="NIC" name="NIC" class="form-control" />
                                            </div>
                                        </div>
                                    </div>


                                    <div class="tab-pane" id="example-tabs2-Contact">
                                        <div class="row">
                                            <div class="col-md-6">
                                                <label class="control-label">Phone No </label>
                                                <input type="number" id="CellNo" name="CellNo" class="form-control" />
                                            </div>
                                            <div class="col-md-6">
                                                <label class="control-label">Other Contact No </label>
                                                <input type="number" id="OtherContact" name="OtherContact" class="form-control" />
                                            </div>
                                            <div class="col-md-6">
                                                <label class="control-label">Home Contact</label>
                                                <input type="number" id="HomeNo" name="HomeNo" class="form-control" />
                                            </div>
                                            <div class="col-md-6">
                                                <label class="control-label">Emergency Contact No</label>
                                                <input type="number" id="EmergencyContactNo" name="EmergencyContactNo" class="form-control" />
                                            </div>
                                            <div class="col-md-6">
                                                <label class="control-label">Contact Relation</label>
                                                <input type="number" id="ContactRelation" name="ContactRelation" class="form-control" />
                                            </div>
                                            <div class="col-md-6">
                                                <label class="control-label">Emergency Contact Name</label>
                                                <input type="text" id="EmergencyContactName" name="EmergencyContactName" class="form-control" />
                                            </div>
                                        </div>
                                    </div>

                                </div>
                                <!-- END Tabs Content -->
                            </div>
                        </div>

                    </div>

                </div>

                <div class="modal-footer">

                    <button type="submit" id="btnSaveEdit" class="btn btn-primary pull-right"><b><i class="fa fa-save"></i> Save</b></button>
                </div>
            }
            <!-- END Modal Body -->
        </div>
    </div>
</div>


<script src="~/Scripts/jquery-3.4.1.min.js"></script>

<link rel="stylesheet" href="~/css/customDataTable.css" />
<link rel="stylesheet" href="~/css/DataTableThemeController.css" />
<link rel="stylesheet" href="https://cdn.datatables.net/buttons/1.6.1/css/buttons.dataTables.min.css" />
<script>

    $(document).ready(function () {
        $("#example").DataTable({
            dom: 'Bfrtip',
            buttons: [
                'copyHtml5',
                'excelHtml5',
                'csvHtml5',
                'pdfHtml5'
            ]
        });
        $(document).on('click', 'button.download-file', function (e) {
            debugger;
            let documentDownloadUrl = "../DriverDocuments/"
            e.preventDefault();
            var FileName = $(this).text().replace("|", "").trim();
            console.log(FileName);
            fetch(documentDownloadUrl + FileName)
                .then(resp => resp.blob())
                .then(blob => {
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.style.display = 'none';
                    a.href = url;
                    a.download = FileName;
                    document.body.appendChild(a);
                    a.click();
                    window.URL.revokeObjectURL(url);

                })
                .catch(() => alert('An error occured'));
        });
        $("#DriverID").change(function () {
            $.ajax({
                url: `../Admin/GetDriverDetails?Id=${$(this).val()}`,
                type: "GET",
                success: function (response) {
                    $("#ContactNo").val(response.Driver.CellNo);
                    $("#SecContact").val(response.Driver.OtherContact);
                    $("#NIC").val(response.Driver.NIC);
                    $("#License").val(response.Driver.LicenseNo);
                    $("#Status").val(response.Driver.LicenseStatus);
                },
                error: function () {

                }
            })
        });
    });

    function fnSuccess(response) {
        if (response.Status != "OK") {
            Message("", response.Message, "error");
        }
        else {
            $('#modal-add').modal('hide');
            Message("Success", "Record Saved Success", "success");
            $("#grid").html(response.html);
            ClearItem();
            GetOrders();
        }
    }

    function fnFailed(error) {
        //alert('Request Failed');
        window.location.reload();
    }

    function Message(title, text, type) {
        Swal.fire({
            title: title + '!',
            text: text,
            icon: type,
            confirmButtonText: 'OK'
        })
    }

    function GetOrders() {
        $('#example').DataTable();
    }

    function ClearItem() {
        $("input[type='text']").val('');
        $("input[type='checkbox']").val('');
        $("input[type='file']").val('');
        $("input[type='hidden']").val('');
        $("input[type='number']").val('');
        $("input[type='datetime-local']").val('');
        $("input[type='date']").val('');
        $("textarea").val('');
        $("#Documents").hide();
    }

    function viewRecord(object, e) {
        console.log(object);
        $("#modal-add").modal('show');
        Enable();
        $("#Code").val(object.Code);
        $("#Name").val(object.Name);
        $("#FatherName").val(object.FatherName);
        $("#Type").val(object.Type);
        $("#BloodGroup").val(object.BloodGroup);
        $("#DateOfBirth").val(object.DateOfBirth);
        $("#Gender").val(object.Gender);
        $("#CellNo").val(object.CellNo);
        $("#OtherContact").val(object.OtherContact);
        $("#HomeNo").val(object.HomeNo);
        $("#Address").val(object.Address);
        $("#NIC").val(object.NIC);
        $("#IdentityMark").val(object.IdentityMark);
        $("#NICIssueDate").val(object.NICIssueDate);
        $("#NICExpiryDate").val(object.NICExpiryDate);
        $("#LicenseNo").val(object.LicenseNo);
        $("#LicenseCategory").val(object.LicenseCategory);
        $("#LicenseIssueDate").val(object.LicenseIssueDate);
        $("#LicenseExpiryDate").val(object.LicenseExpiryDate);
        $("#LicenseIssuingAuthority").val(object.LicenseIssuingAuthority);
        $("#LicenseStatus").val(object.LicenseStatus);
        $("#EmergencyContactName").val(object.EmergencyContactName);
        $("#EmergencyContactNo").val(object.EmergencyContactNo);
        $("#ContactRelation").val(object.ContactRelation);
        $("#HomeNo").val(object.HomeNo);
        $("#Description").val(object.Description);
        $("#Documents").show();
        $("#Documents").html(object.Documents + " | <i class='fa fa-download'></i>");
        let OrderID = object.ID;
        $("#hfEditID").val(OrderID);
    }

    function viewRecordRead(object, e) {
        console.log(object);
        $("#modal-add").modal('show');
        Disable();
        $("#Code").val(object.Code);
        $("#Name").val(object.Name);
        $("#FatherName").val(object.FatherName);
        $("#Type").val(object.Type);
        $("#BloodGroup").val(object.BloodGroup);
        $("#DateOfBirth").val(object.DateOfBirth);
        $("#Gender").val(object.Gender);
        $("#CellNo").val(object.CellNo);
        $("#OtherContact").val(object.OtherContact);
        $("#HomeNo").val(object.HomeNo);
        $("#Address").val(object.Address);
        $("#NIC").val(object.NIC);
        $("#IdentityMark").val(object.IdentityMark);
        $("#NICIssueDate").val(object.NICIssueDate);
        $("#NICExpiryDate").val(object.NICExpiryDate);
        $("#LicenseNo").val(object.LicenseNo);
        $("#LicenseCategory").val(object.LicenseCategory);
        $("#LicenseIssueDate").val(object.LicenseIssueDate);
        $("#LicenseExpiryDate").val(object.LicenseExpiryDate);
        $("#LicenseIssuingAuthority").val(object.LicenseIssuingAuthority);
        $("#LicenseStatus").val(object.LicenseStatus);
        $("#EmergencyContactName").val(object.EmergencyContactName);
        $("#EmergencyContactNo").val(object.EmergencyContactNo);
        $("#ContactRelation").val(object.ContactRelation);
        $("#Description").val(object.Description);
        $("#HomeNo").val(object.HomeNo);
        $("#Documents").show();
        $("#Documents").html(object.Documents + " | <i class='fa fa-download'></i>");
        let OrderID = object.ID;
        $("#hfEditID").val(OrderID);
    }

    function Disable() {
        $("#Code").attr("readonly", true);
        $("#Name").attr("readonly", true);
        $("#FatherName").attr("readonly", true);
        $("#Type").attr("readonly", true);
        $("#BloodGroup").attr("readonly", true);
        $("#DateOfBirth").attr("readonly", true);
        $("#Gender").attr("readonly", true);
        $("#CellNo").attr("readonly", true);
        $("#OtherContact").attr("readonly", true);
        $("#HomeNo").attr("readonly", true);
        $("#Address").attr("readonly", true);
        $("#NIC").attr("readonly", true);
        $("#IdentityMark").attr("readonly", true);
        $("#NICIssueDate").attr("readonly", true);
        $("#NICExpiryDate").attr("readonly", true);
        $("#LicenseNo").attr("readonly", true);
        $("#LicenseCategory").attr("readonly", true);
        $("#LicenseIssueDate").attr("readonly", true);
        $("#LicenseExpiryDate").attr("readonly", true);
        $("#LicenseIssuingAuthority").attr("readonly", true);
        $("#LicenseStatus").attr("readonly", true);
        $("#EmergencyContactName").attr("readonly", true);
        $("#EmergencyContactNo").attr("readonly", true);
        $("#ContactRelation").attr("readonly", true);
        $("#Description").attr("readonly", true);
        $("#Documents").attr("readonly", true);
        $("#Documents").attr("readonly", true);
        $("#Address").attr("readonly", true);
    }

    function Enable() {
        $("#Code").attr("readonly", false);
        $("#Name").attr("readonly", false);
        $("#FatherName").attr("readonly", false);
        $("#Type").attr("readonly", false);
        $("#BloodGroup").attr("readonly", false);
        $("#DateOfBirth").attr("readonly", false);
        $("#Gender").attr("readonly", false);
        $("#CellNo").attr("readonly", false);
        $("#OtherContact").attr("readonly", false);
        $("#HomeNo").attr("readonly", false);
        $("#Address").attr("readonly", false);
        $("#NIC").attr("readonly", false);
        $("#IdentityMark").attr("readonly", false);
        $("#NICIssueDate").attr("readonly", false);
        $("#NICExpiryDate").attr("readonly", false);
        $("#LicenseNo").attr("readonly", false);
        $("#LicenseCategory").attr("readonly", false);
        $("#LicenseIssueDate").attr("readonly", false);
        $("#LicenseExpiryDate").attr("readonly", false);
        $("#LicenseIssuingAuthority").attr("readonly", false);
        $("#LicenseStatus").attr("readonly", false);
        $("#EmergencyContactName").attr("readonly", false);
        $("#EmergencyContactNo").attr("readonly", false);
        $("#ContactRelation").attr("readonly", false);
        $("#Description").attr("readonly", false);
        $("#Documents").attr("readonly", false);
        $("#Documents").attr("readonly", false);
        $("#Address").attr("readonly", false);
    }

    function DeleteModel(Id) {
        debugger;
        Swal.fire({
            title: 'Are you sure?',
            text: "You won't be able to revert this!",
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#3085d6',
            cancelButtonColor: '#d33',
            confirmButtonText: 'Yes, delete it!'
        }).then((result) => {
            if (result.value) {
                $.ajax({
                    url: `../Admin/DeleteDriver`,
                    type: 'POST',
                    data: { ID: Id },
                    success: function (res) {
                        if (res.Status != "OK") {
                            Message("Error", res.Message, "error");
                        }
                        else {
                            $("#grid").html(res.html);
                            GetOrders();
                            Message("Success", "Record Deleted Success", "success");
                        }
                    },
                    error: function () {
                        alert('error');
                    }
                });

            }
        })

    }
</script>